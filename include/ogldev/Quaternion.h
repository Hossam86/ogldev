#pragma once

#include <ogldev/Vector3f.h>

struct Quaternion
{
	float x, y, z, w;

	Quaternion(float Angle, const Vector3f& V)
	{
		float HalfAngleInRadians = ToRadian(Angle / 2);

		float SineHalfAngle = sinf(HalfAngleInRadians);
		float CosHalfAngle = cosf(HalfAngleInRadians);

		x = V.x * SineHalfAngle;
		y = V.y * SineHalfAngle;
		z = V.z * SineHalfAngle;
		w = CosHalfAngle;
	}

	Quaternion(float _x, float _y, float _z, float _w)
	{
		x = _x;
		y = _y;
		z = _z;
		w = _w;
	}

	void
	Normalize()
	{
		float Length = sqrtf(x * x + y * y + z * z + w * w);

		x /= Length;
		y /= Length;
		z /= Length;
		w /= Length;
	}

	Quaternion
	Conjugate() const
	{
		Quaternion ret(-x, -y, -z, w);
		return ret;
	}

	Vector3f
	ToDegrees()
	{
		float f[3];

		f[0] = atan2(x * z + y * w, x * w - y * z);
		f[1] = acos(-x * x - y * y - z * z - w * w);
		f[2] = atan2(x * z - y * w, x * w + y * z);

		f[0] = ToDegree(f[0]);
		f[1] = ToDegree(f[1]);
		f[2] = ToDegree(f[2]);

		return Vector3f(f);
	}
};

Quaternion
operator*(const Quaternion& l, const Quaternion& r)
{
	float w = (l.w * r.w) - (l.x * r.x) - (l.y * r.y) - (l.z * r.z);
	float x = (l.x * r.w) + (l.w * r.x) + (l.y * r.z) - (l.z * r.y);
	float y = (l.y * r.w) + (l.w * r.y) + (l.z * r.x) - (l.x * r.z);
	float z = (l.z * r.w) + (l.w * r.z) + (l.x * r.y) - (l.y * r.x);

	Quaternion ret(x, y, z, w);

	return ret;
}

Quaternion
operator*(const Quaternion& q, const Vector3f& v)
{
	float w = -(q.x * v.x) - (q.y * v.y) - (q.z * v.z);
	float x = (q.w * v.x) + (q.y * v.z) - (q.z * v.y);
	float y = (q.w * v.y) + (q.z * v.x) - (q.x * v.z);
	float z = (q.w * v.z) + (q.x * v.y) - (q.y * v.x);

	Quaternion ret(x, y, z, w);

	return ret;
}

void
Rotate(Vector3f& vector, float Angle, const Vector3f& Axis)
{
	Quaternion RotationQ(Angle, Axis);

	Quaternion ConjugateQ = RotationQ.Conjugate();

	Quaternion W = RotationQ * (vector)*ConjugateQ;

	vector.x = W.x;
	vector.y = W.y;
	vector.z = W.z;
}